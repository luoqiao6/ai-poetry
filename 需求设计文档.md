# AI诗词推荐和赏析应用 - 详细需求设计文档

## 1. 项目概述

### 1.1 项目背景
开发一个基于AI大模型的诗词推荐和赏析应用，通过AI技术为用户提供个性化的诗词推荐和深度赏析服务。

### 1.2 项目目标
- 利用AI大模型能力，根据用户需求智能推荐相关诗词
- 提供诗词的深度赏析和解读
- 支持多平台客户端访问
- 提供完善的后台管理系统

### 1.3 系统架构概览
```
┌─────────────┐
│   客户端    │ (移动端/PC端)
└──────┬──────┘
       │ HTTP/HTTPS
┌──────▼──────────────────┐
│    应用API接口层         │
└──────┬──────────────────┘
       │
┌──────▼──────────────────┐
│    Web后台管理系统       │
└──────┬──────────────────┘
       │
┌──────▼──────────────────┐
│  AI诗词推荐Agent程序     │
└──────┬──────────────────┘
       │
┌──────▼──────────────────┐
│    AI大模型API接口       │
└─────────────────────────┘
       │
┌──────▼──────────────────┐
│      数据库              │
└─────────────────────────┘
```

---

## 2. 第一部分：AI 诗词推荐程序（AI 诗词推荐 Agent）

### 2.1 功能概述
在服务器上运行的后台命令行程序，作为AI Agent，负责调用AI大模型接口获取诗词推荐和赏析内容，并将结果保存到数据库。

### 2.2 核心功能需求

#### 2.2.1 命令行接口
- **程序入口**：支持命令行参数输入
- **参数列表**：
  - `--prompt` / `-p`: 用户提示词（必填）
  - `--context` / `-c`: 上下文信息（可选）
  - `--model` / `-m`: 指定使用的AI模型（可选，有默认值）
  - `--count` / `-n`: 推荐诗词数量（可选，默认1首）
  - `--type` / `-t`: 推荐类型（推荐/赏析/创作，可选）
  - `--config` / `-f`: 配置文件路径（可选）
  - `--verbose` / `-v`: 详细输出模式（可选）

#### 2.2.2 AI大模型接口调用
- **支持的AI模型**：
  - OpenAI GPT系列
  - 百度文心一言
  - 阿里通义千问
  - 其他主流大模型API
- **提示词工程**：
  - 构建标准化的提示词模板
  - 支持上下文信息注入
  - 支持多轮对话上下文
- **请求处理**：
  - 参数验证和格式化
  - API密钥管理
  - 请求重试机制
  - 超时处理
  - 错误处理和日志记录

#### 2.2.3 数据解析与存储
- **响应解析**：
  - 解析AI返回的JSON/文本格式
  - 提取诗词内容、作者、朝代等信息
  - 提取赏析内容
  - 数据清洗和格式化
- **数据库存储**：
  - 保存推荐诗词的完整信息
  - 保存提示词和上下文
  - 保存AI模型信息
  - 保存请求时间戳
  - 保存请求状态（成功/失败）

#### 2.2.4 执行结果返回
- **返回状态码**：
  - 0: 执行成功
  - 1: 参数错误
  - 2: API调用失败
  - 3: 数据库操作失败
  - 4: 其他错误
- **返回信息**：
  - 成功：返回保存的记录ID和简要信息
  - 失败：返回详细的错误信息

### 2.3 数据模型设计

#### 2.3.1 推荐记录表（recommendations）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键，自增 |
| prompt | TEXT | 用户输入的提示词 |
| context | TEXT | 上下文信息 |
| poem_title | VARCHAR(200) | 诗词标题 |
| poem_content | TEXT | 诗词内容 |
| author | VARCHAR(100) | 作者 |
| dynasty | VARCHAR(50) | 朝代 |
| appreciation | TEXT | 赏析内容 |
| model_name | VARCHAR(100) | 使用的AI模型 |
| model_version | VARCHAR(50) | 模型版本 |
| status | TINYINT | 状态（1:成功 0:失败） |
| error_message | TEXT | 错误信息（如有） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 2.4 技术实现要求
- **编程语言**：Python 3.8+
- **依赖库**：
  - `argparse`: 命令行参数解析
  - `requests` / `openai`: AI API调用
  - `sqlalchemy` / `pymysql`: 数据库操作
  - `python-dotenv`: 环境变量管理
  - `logging`: 日志记录
- **配置文件**：
  - 数据库连接配置
  - AI API密钥配置
  - 模型默认参数配置

### 2.5 使用示例
```bash
# 基本使用
python poetry_agent.py --prompt "推荐一首关于春天的诗"

# 完整参数
python poetry_agent.py \
  --prompt "推荐一首关于春天的诗" \
  --context "用户喜欢唐诗" \
  --model "gpt-4" \
  --count 3 \
  --type "推荐" \
  --verbose

# 使用配置文件
python poetry_agent.py --config config.json --prompt "推荐一首诗"
```

---

## 3. 第二部分：应用API接口

### 3.1 功能概述
提供RESTful API接口，供客户端调用，返回数据库中存储的AI推荐诗词内容。

### 3.2 API接口设计

#### 3.2.1 获取推荐列表
- **接口路径**：`GET /api/v1/recommendations`
- **功能**：分页获取推荐诗词列表
- **请求参数**：
  - `page`: 页码（默认1）
  - `page_size`: 每页数量（默认10，最大100）
  - `keyword`: 关键词搜索（可选）
  - `author`: 作者筛选（可选）
  - `dynasty`: 朝代筛选（可选）
  - `sort`: 排序方式（created_at_desc/created_at_asc，默认desc）
- **响应格式**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 10,
    "items": [
      {
        "id": 1,
        "poem_title": "春晓",
        "poem_content": "春眠不觉晓...",
        "author": "孟浩然",
        "dynasty": "唐",
        "appreciation": "...",
        "created_at": "2024-01-01T10:00:00Z"
      }
    ]
  }
}
```

#### 3.2.2 获取推荐详情
- **接口路径**：`GET /api/v1/recommendations/{id}`
- **功能**：获取单条推荐记录的详细信息
- **路径参数**：
  - `id`: 推荐记录ID
- **响应格式**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "prompt": "推荐一首关于春天的诗",
    "context": "用户喜欢唐诗",
    "poem_title": "春晓",
    "poem_content": "春眠不觉晓...",
    "author": "孟浩然",
    "dynasty": "唐",
    "appreciation": "...",
    "model_name": "gpt-4",
    "created_at": "2024-01-01T10:00:00Z"
  }
}
```

#### 3.2.3 搜索诗词
- **接口路径**：`GET /api/v1/poems/search`
- **功能**：根据关键词搜索诗词
- **请求参数**：
  - `q`: 搜索关键词（必填）
  - `page`: 页码
  - `page_size`: 每页数量
- **响应格式**：同推荐列表

#### 3.2.4 获取统计信息
- **接口路径**：`GET /api/v1/statistics`
- **功能**：获取系统统计信息
- **响应格式**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total_recommendations": 1000,
    "total_poems": 500,
    "authors_count": 50,
    "dynasties": ["唐", "宋", "元", "明", "清"]
  }
}
```

### 3.3 技术实现要求
- **框架选择**：Flask / FastAPI / Django REST Framework
- **功能要求**：
  - RESTful API设计规范
  - 统一的响应格式
  - 参数验证
  - 错误处理
  - API文档（Swagger/OpenAPI）
  - 跨域支持（CORS）
  - 请求限流
  - 日志记录

### 3.4 安全要求
- API密钥认证（可选）
- 请求频率限制
- 输入参数验证和过滤
- SQL注入防护
- XSS防护

---

## 4. 第三部分：系统运行Web后台管理系统

### 4.1 功能概述
提供Web管理界面，用于管理系统配置、查看和管理AI推荐内容、管理用户提示词等。

### 4.2 功能模块

#### 4.2.1 仪表盘（Dashboard）
- **功能**：系统概览和统计信息
- **内容**：
  - 推荐总数统计
  - 今日/本周/本月推荐数量
  - 成功率统计
  - 模型使用统计
  - 热门作者/朝代统计
  - 系统运行状态

#### 4.2.2 推荐内容管理
- **功能列表**：
  - 推荐列表查看（支持分页、筛选、搜索）
  - 推荐详情查看
  - 推荐内容编辑
  - 推荐内容删除
  - 批量操作（批量删除、批量导出）
  - 推荐内容审核（可选）

#### 4.2.3 Agent程序配置管理
- **功能列表**：
  - AI模型配置管理
    - 添加/编辑/删除模型配置
    - 设置默认模型
    - API密钥管理
  - 提示词模板管理
    - 创建/编辑/删除提示词模板
    - 模板变量配置
  - Agent运行参数配置
    - 超时时间设置
    - 重试次数设置
    - 默认参数配置

#### 4.2.4 任务管理
- **功能列表**：
  - 手动触发推荐任务
  - 定时任务配置（可选）
  - 任务执行历史查看
  - 任务执行日志查看
  - 任务状态监控

#### 4.2.5 用户提示词管理（未来功能）
- **功能列表**：
  - 用户提示词列表
  - 提示词统计分析
  - 热门提示词统计
  - 提示词分类管理

#### 4.2.6 系统设置
- **功能列表**：
  - 数据库配置
  - 系统参数配置
  - 日志级别设置
  - 备份和恢复
  - 用户权限管理（可选）

### 4.3 页面设计

#### 4.3.1 主要页面
1. **登录页面**：管理员登录
2. **仪表盘页面**：数据概览
3. **推荐管理页面**：列表、详情、编辑
4. **配置管理页面**：模型配置、提示词模板
5. **任务管理页面**：任务列表、执行日志
6. **系统设置页面**：系统参数配置

#### 4.3.2 UI/UX要求
- 响应式设计，支持PC和移动端
- 现代化UI设计
- 良好的用户体验
- 数据可视化（图表展示）

### 4.4 技术实现要求
- **前端技术**：
  - Vue.js / React
  - Element UI / Ant Design
  - Axios（HTTP请求）
  - ECharts（数据可视化）
- **后端技术**：
  - 可与API接口层共用或独立实现
  - 需要额外的管理接口
- **功能要求**：
  - 用户认证和授权
  - 会话管理
  - 文件上传（如需要）
  - 数据导出（Excel/CSV）

---

## 5. 第四部分：客户端应用

### 5.1 功能概述
多平台客户端应用，为用户提供诗词推荐和赏析服务。

### 5.2 核心功能需求

#### 5.2.1 诗词推荐
- **功能**：根据用户输入获取AI推荐的诗词
- **交互流程**：
  1. 用户输入提示词（如"推荐一首关于春天的诗"）
  2. 可选输入上下文信息
  3. 提交请求
  4. 显示加载状态
  5. 展示推荐结果

#### 5.2.2 诗词浏览
- **功能列表**：
  - 推荐列表浏览
  - 诗词详情查看
  - 分页加载
  - 下拉刷新
  - 上拉加载更多

#### 5.2.3 诗词搜索
- **功能**：根据关键词搜索诗词
- **支持搜索**：
  - 诗词标题
  - 诗词内容
  - 作者
  - 朝代

#### 5.2.4 诗词收藏
- **功能**：收藏喜欢的诗词
- **功能点**：
  - 添加收藏
  - 取消收藏
  - 收藏列表查看
  - 收藏管理

#### 5.2.5 诗词分享
- **功能**：分享诗词到其他平台
- **支持平台**：
  - 微信
  - 微博
  - 复制链接
  - 生成图片分享

#### 5.2.6 个人中心（未来功能）
- **功能列表**：
  - 用户信息
  - 我的收藏
  - 浏览历史
  - 设置

### 5.3 平台适配

#### 5.3.1 移动端（iOS/Android）
- **技术方案**：
  - 原生开发（Swift/Kotlin）
  - 跨平台框架（React Native / Flutter）
- **功能要求**：
  - 适配不同屏幕尺寸
  - 支持横竖屏切换
  - 离线缓存（可选）
  - 推送通知（可选）

#### 5.3.2 平板电脑
- **功能要求**：
  - 适配平板屏幕
  - 优化布局显示
  - 支持分屏显示

#### 5.3.3 PC端
- **技术方案**：
  - Web应用（响应式设计）
  - 桌面应用（Electron）
- **功能要求**：
  - 适配不同分辨率
  - 键盘快捷键支持
  - 更好的阅读体验

### 5.4 UI/UX设计要求
- **设计风格**：简洁、优雅、具有文化气息
- **色彩方案**：符合诗词文化主题
- **字体选择**：支持中文字体优化
- **交互体验**：
  - 流畅的动画效果
  - 友好的错误提示
  - 加载状态提示
  - 空状态提示

### 5.5 技术实现要求
- **API集成**：调用第二部分提供的API接口
- **数据缓存**：本地缓存推荐内容
- **网络处理**：网络错误处理、重试机制
- **性能优化**：图片懒加载、列表虚拟滚动

---

## 6. 数据库设计

### 6.1 数据库选型
- **推荐**：MySQL 8.0+ / PostgreSQL
- **备选**：SQLite（开发测试环境）

### 6.2 数据表设计

#### 6.2.1 推荐记录表（recommendations）
见2.3.1节

#### 6.2.2 模型配置表（model_configs）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| name | VARCHAR(100) | 模型名称 |
| api_provider | VARCHAR(50) | API提供商 |
| api_endpoint | VARCHAR(200) | API端点 |
| api_key | VARCHAR(200) | API密钥（加密存储） |
| default_params | JSON | 默认参数 |
| is_default | TINYINT | 是否默认模型 |
| status | TINYINT | 状态（1:启用 0:禁用） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 6.2.3 提示词模板表（prompt_templates）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| name | VARCHAR(100) | 模板名称 |
| template | TEXT | 模板内容 |
| variables | JSON | 变量定义 |
| type | VARCHAR(50) | 模板类型 |
| is_default | TINYINT | 是否默认 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 6.2.4 任务执行记录表（task_logs）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| task_type | VARCHAR(50) | 任务类型 |
| prompt | TEXT | 提示词 |
| status | TINYINT | 执行状态 |
| result_id | BIGINT | 结果记录ID |
| error_message | TEXT | 错误信息 |
| execution_time | INT | 执行时间（毫秒） |
| created_at | DATETIME | 创建时间 |

#### 6.2.5 用户收藏表（user_favorites）（未来功能）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| recommendation_id | BIGINT | 推荐记录ID |
| created_at | DATETIME | 收藏时间 |

### 6.3 索引设计
- `recommendations`: 在 `created_at`, `author`, `dynasty` 上建立索引
- `task_logs`: 在 `created_at`, `status` 上建立索引

---

## 7. 技术栈建议

### 7.1 后端技术栈
- **编程语言**：Python 3.8+
- **Web框架**：FastAPI / Flask
- **数据库**：MySQL / PostgreSQL
- **ORM**：SQLAlchemy
- **API文档**：Swagger/OpenAPI
- **任务队列**：Celery（可选，用于异步任务）

### 7.2 前端技术栈（Web管理后台）
- **框架**：Vue.js 3 / React
- **UI组件库**：Element Plus / Ant Design
- **状态管理**：Vuex / Redux
- **HTTP客户端**：Axios
- **构建工具**：Vite / Webpack

### 7.3 客户端技术栈
- **移动端**：React Native / Flutter
- **PC Web**：Vue.js / React（响应式）
- **桌面应用**：Electron（可选）

### 7.4 开发工具
- **版本控制**：Git
- **代码规范**：Black, ESLint
- **测试框架**：pytest, Jest
- **API测试**：Postman
- **容器化**：Docker（可选）

---

## 8. 开发计划

### 8.1 第一阶段：AI诗词推荐Agent（当前阶段）
- [ ] 项目初始化
- [ ] 数据库设计和创建
- [ ] AI大模型API调研和集成
- [ ] 命令行程序开发
- [ ] 数据存储功能实现
- [ ] 单元测试
- [ ] 文档编写

### 8.2 第二阶段：API接口开发
- [ ] API框架搭建
- [ ] 数据库模型实现
- [ ] API接口开发
- [ ] API文档生成
- [ ] 接口测试
- [ ] 性能优化

### 8.3 第三阶段：Web后台管理系统
- [ ] 前端项目初始化
- [ ] 后端管理接口开发
- [ ] 前端页面开发
- [ ] 功能测试
- [ ] UI优化

### 8.4 第四阶段：客户端开发
- [ ] 客户端架构设计
- [ ] 核心功能开发
- [ ] 多平台适配
- [ ] 用户体验优化
- [ ] 测试和发布

---

## 9. 非功能性需求

### 9.1 性能要求
- API响应时间 < 500ms（数据库查询）
- 支持并发用户数 > 100
- 数据库查询优化

### 9.2 可用性要求
- 系统可用性 > 99%
- 错误处理和恢复机制
- 日志记录和监控

### 9.3 安全性要求
- 数据加密存储（敏感信息）
- API安全防护
- 输入验证和过滤
- 防止SQL注入和XSS攻击

### 9.4 可维护性要求
- 代码规范统一
- 完善的注释和文档
- 模块化设计
- 易于扩展

---

## 10. 风险评估

### 10.1 技术风险
- AI API调用失败或限流
- 数据库性能瓶颈
- 跨平台兼容性问题

### 10.2 业务风险
- AI推荐质量不稳定
- 用户需求变化
- 竞品分析

### 10.3 应对措施
- 实现重试机制和降级方案
- 数据库优化和缓存策略
- 充分测试和用户反馈收集

---

## 11. 附录

### 11.1 术语表
- **Agent**：智能代理程序，能够自主执行任务
- **Prompt**：提示词，用于指导AI模型生成内容
- **API**：应用程序编程接口
- **RESTful**：一种API设计风格

### 11.2 参考资料
- AI大模型API文档
- RESTful API设计规范
- 数据库设计最佳实践

---

**文档版本**：v1.0  
**创建日期**：2024年  
**最后更新**：2024年

